<h1 class="market-title">상점</h1>

{{#let (or @groups []) as |groups|}}
  {{#if groups.length}}
    {{#each groups as |group|}}
      <section class="market-section">
        <h2 class="market-section-title">{{group.category}}</h2>

        <div class="market-grid">
          {{#let (or group.items []) as |items|}}
            {{#each items as |item|}}
              <article class="market-card">
                <div class="market-media">
                  {{#if item.image_url}}
                    <img class="market-thumb" src={{item.image_url}} alt={{item.name}} loading="lazy" />
                  {{else}}
                    <img class="market-thumb" src={{get-url "/plugins/dk-market/images/no_image.png"}} alt="이미지 없음" loading="lazy" />
                  {{/if}}
                </div>

                <div class="market-info">
                  <h3 class="market-name">{{item.name}}</h3>

                  <div class="market-price-row">
                    {{#if item.is_limited_duration}}
                      <span class="badge badge-duration">기간제 {{item.duration_days}}일</span>
                    {{/if}} 
                    <span class="market-price">{{item.price_points}} 포인트</span>
                  </div>

                  <button
                    class="btn buy-btn"
                    disabled={{or item.owned item.isCooldown}}
                    aria-disabled={{or item.owned item.isCooldown}}
                    title={{if item.owned "이미 보유한 아이템입니다" "구매"}}
                    {{on "click" (fn this.buy item)}}
                  >
                    {{if item.owned "보유중" "구매"}}
                  </button>
                </div>
              </article>
            {{/each}}
          {{/let}}
        </div>
      </section>
    {{/each}}
  {{else}}
    <p class="market-empty">구매한 아이템이 없습니다.</p>
  {{/if}}
{{/let}}
